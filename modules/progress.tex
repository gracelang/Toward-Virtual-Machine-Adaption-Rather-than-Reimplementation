%!TEX root = ../paper.tex

% ---------------------------------------------------------------------------- %
% Outline

\iftoggle{outline}{

    \begin{itemize}
        \item Progress so far
        \item Diagram of components
        \item Benchmarks and description
    \end{itemize}

}

% 
% ---------------------------------------------------------------------------- %

Reusing an existing \Grace parser, we translate \Grace's \AST nodes into those used by \SOMns to have a basic \Grace \VM/, see \autoref{fig:components}.
Thus, we modified \SOMns to use our translator. When called, the \translator first parses \Grace's \prelude and then continues to the input program.
Once an \AST has been formed, the translator composes the program representation based on \SOMns's Truffle nodes. 

\begin{figure}
    \centering
    \makebox[\columnwidth][c]{
        \resizebox{\columnwidth}{!}{
            \input{content/tikz/components.tikz}
        }
    }
    \caption{The components of \SOMns and those used to adapt the implementation to a \Grace \VM/. We used an existing prelude and parser for \Grace.}
    \label{fig:components}
\end{figure}

For the initial proof of concept, we implemented expression nodes, numerals and string nodes, as well as nodes to maintain lexical scoping for block and methods. The translator is little more than an AST visitor that reads the nodes in one form and exports them in other; and in a few cases it composes together multiple nodes to preserve \Grace's semantics. 

\begin{figure}
    \centering
    \makebox[\columnwidth][c]{
        \resizebox{\columnwidth}{!}{
            \input{content/tikz/benchmarks.tikz}
        }
    }
    \caption{The execution time reported by \SOMns when executing three integer-based benchmarks: calculating the factorial of 100, calculating the sum the natural numbers from zero up to one million, and calculating $500$ interations of the mandelbrot fractal. The implementations of these benchmarks in \Grace and \Newspeak have only negliable differences. The table depicts the average execution time over $1000$ iterations, with and without the \Graal optimization layer.}
    \label{fig:benchmark}
\end{figure}

Despite being tailored to \Newspeak, \SOMns can be easily adapted to \Grace through our translator. As depicted in \autoref{fig:benchmark}, there is only a marginal loss of performance due to the additional translation step. 



We have presented an experiment in which we realized an \VM/ for Grace from SOMns, while retaining much of the \AST/ optimizations. While further experiments are required before we can quantify the extent to which the similarity of the languages, the craft of SOMns, and the flexibility of Truffle contribute to the ability to make such an adaption. 


